# BMAD BMM Workflow: dev-story-with-tasks

**Workflow Type:** Story Development  
**Agent:** Dev  
**Phase:** Implementation

## Purpose

Implement a story by working through tasks, updating task statuses, and ensuring all tasks are complete before marking story ready for test validation.

## Workflow Steps

### Step 1: Verify Tasks Exist

**CRITICAL:** Before starting implementation, verify all tasks are created in OpenProject.

```python
# Verify tasks exist
children = mcp_openproject_get_work_package_children(parent_id=story_id)
tasks = [c for c in children["children"] if c["type"] == "Task"]

if not tasks:
    raise Exception("No tasks found. PM must create tasks during grooming phase.")
```

### Step 2: Implement Tasks Sequentially

**For each task:**

1. **Start Task** → Update status to "In progress" (77)
2. **IMMEDIATELY Update Story** → If first task, update story to "In progress" (77)
3. **Implement** → Write code, run tests
4. **Complete Task** → Update status to "In testing" (79)
5. **IMMEDIATELY Update Story** → If test task ready, update story to "In testing" (79)
6. **Add Comment** → Document implementation and test results
7. **Update Story File** → Mark task as complete

```python
# Start task
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id=77  # In progress
)

# IMMEDIATE: Update story status if this is the first task
from scripts.openproject_status_helpers import update_story_status_based_on_tasks
update_story_status_based_on_tasks(story_id)

# ... implement task ...

# Mark task ready for test
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id=79,  # In testing
    description="Task complete. Tests passed. Ready for test team validation."
)

# IMMEDIATE: Update story status if test task ready
if ".T:" in task_subject or "Testing and Validation" in task_subject:
    from scripts.openproject_status_helpers import update_story_status_when_test_task_ready
    update_story_status_when_test_task_ready(story_id, task_id)

# Add comment
mcp_openproject_add_work_package_comment(
    work_package_id=task_id,
    comment="Implementation complete. Unit tests: Pass. Integration tests: Pass."
)
```

### Step 3: Handle Bugs

**When bug is created:**

1. **Review Bug** → Get bug details
2. **Fix Bug** → Update status to "In progress" (77)
3. **Complete Fix** → Update status to "In testing" (79)
4. **Add Comment** → Document fix
5. **Iterate** → If test fails, fix again

```python
# Fix bug
mcp_openproject_update_work_package(
    work_package_id=bug_id,
    status_id=77  # In progress
)

# ... fix bug ...

# Mark bug ready for test
mcp_openproject_update_work_package(
    work_package_id=bug_id,
    status_id=79,  # In testing
    description="Bug fixed. Ready for test team validation."
)
```

### Step 4: Close Tasks and Update Story Status

**IMMEDIATE Status Updates:**

When closing a task or bug, IMMEDIATELY update story status:

```python
# Close task
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id=82  # Closed
)

# IMMEDIATE: Update story status if all tasks/bugs closed
from scripts.openproject_status_helpers import update_story_status_when_all_tasks_closed
update_story_status_when_all_tasks_closed(story_id)
```

**Note:** The helper function automatically:
- Checks if all tasks and bugs are closed
- Updates story to "Closed" (82) if all closed
- Triggers epic status update if all stories in epic are closed

## Checklist

**Before starting implementation:**
- [ ] Verify all tasks exist in OpenProject
- [ ] Verify all tasks are linked to story
- [ ] Review task descriptions and acceptance criteria

**During implementation:**
- [ ] Update task status as work progresses
- [ ] Add comments to tasks documenting progress
- [ ] Update story file to mark tasks complete
- [ ] Fix bugs assigned by test team
- [ ] Iterate on bug fixes until closed

**Before marking story ready for test:**
- [ ] All tasks are "Closed" (82)
- [ ] All bugs are "Closed" (82)
- [ ] Story marked "In testing" (79)

## References

- **Epic-Story Lifecycle:** `@bmad/bmm/workflows/epic-story-lifecycle` - Complete lifecycle requirements
- **Status Helpers:** `scripts/openproject_status_helpers.py` - Helper functions for status transitions
- **QA Testing Workflow:** `docs/QA_TESTING_WORKFLOW.md`
- **Complete Agile Workflow:** `docs/COMPLETE_AGILE_WORKFLOW.md`
- **Task Management:** `docs/TASK_MANAGEMENT_PROCESS.md`
- **Dev Story Workflow:** `@bmad/bmm/workflows/dev-story`
