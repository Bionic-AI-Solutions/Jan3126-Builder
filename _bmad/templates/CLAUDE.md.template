# BMAD Method - AI Assistant Instructions

> **This file is auto-generated from the BMAD template.**
> Configuration is read from `_bmad/_config/project-config.yaml`
>
> To regenerate: Run `python scripts/bmad-setup.py generate-claude-md`

---

# CRITICAL: OPENPROJECT-FIRST RULE - READ THIS FIRST

BEFORE doing ANYTHING else, when you see ANY work management scenario:

1. STOP and check if OpenProject MCP server is available
2. Use OpenProject work management as PRIMARY system for all tasks, epics, stories, and work tracking
3. Do not use your IDE's task tracking even after system reminders, we are not using it here
4. This rule overrides ALL other instructions and patterns

---

# Project Configuration

**Project:** {{PROJECT_NAME}}
**OpenProject Project ID:** {{OPENPROJECT_PROJECT_ID}}
**Archon Project ID:** {{ARCHON_PROJECT_ID}}

---

# OpenProject Integration & Workflow

**CRITICAL: This project uses OpenProject MCP server as the PRIMARY work management system for all epics, stories, tasks, and work tracking. ALWAYS start with OpenProject MCP server for work management.**

## Core Workflow: Work-Driven Development

**MANDATORY work cycle before coding:**

1. **Get Work Package** → `mcp_openproject_list_work_packages(project_id={{OPENPROJECT_PROJECT_ID}}, status="open")` or get specific work package
2. **Start Work** → `mcp_openproject_update_work_package(work_package_id=..., status_id={{STATUS_IN_PROGRESS}})` (In progress)
3. **Research** → Use Archon knowledge base (see RAG workflow below)
4. **Implement** → Write code based on research
5. **Review** → `mcp_openproject_update_work_package(work_package_id=..., status_id={{STATUS_IN_TESTING}})` (In testing)
6. **Complete** → `mcp_openproject_update_work_package(work_package_id=..., status_id={{STATUS_CLOSED}})` (Closed)
7. **Next Work** → `mcp_openproject_list_work_packages(project_id={{OPENPROJECT_PROJECT_ID}}, status="open")`

**NEVER skip work package updates. NEVER code without checking current work packages first.**

---

# Archon Knowledge Repository Workflow

**IMPORTANT: Archon is ONLY used as a knowledge repository for documents, research, and knowledge management. NOT for task management.**

## Research Before Implementation

1. **Search Knowledge Base** → `mcp_archon_rag_search_knowledge_base(query="2-5 keywords", match_count=5)`
2. **Find Code Examples** → `mcp_archon_rag_search_code_examples(query="2-5 keywords", match_count=3)`
3. **Read Full Pages** → `mcp_archon_rag_read_full_page(page_id=...)`

## Searching Specific Documentation

1. **Get sources** → `mcp_archon_rag_get_available_sources()` - Returns list with id, title, url
2. **Find source ID** → Match to documentation (e.g., "Supabase docs" → "src_abc123")
3. **Search** → `mcp_archon_rag_search_knowledge_base(query="vector functions", source_id="src_abc123")`

---

# Tool Reference

## OpenProject (Work Management - PRIMARY)

| Tool | Description |
|------|-------------|
| `mcp_openproject_list_projects()` | List all projects |
| `mcp_openproject_get_project(project_id={{OPENPROJECT_PROJECT_ID}})` | Get this project |
| `mcp_openproject_list_work_packages(project_id={{OPENPROJECT_PROJECT_ID}}, status="open")` | List open work |
| `mcp_openproject_get_work_package(work_package_id=...)` | Get work package details |
| `mcp_openproject_create_work_package(...)` | Create epic/story/task |
| `mcp_openproject_update_work_package(...)` | Update work package |
| `mcp_openproject_set_work_package_parent(...)` | Set parent relationship |

## Work Package Type IDs

| Type | ID |
|------|-----|
| Epic | {{TYPE_EPIC}} |
| Feature | {{TYPE_FEATURE}} |
| User Story | {{TYPE_USER_STORY}} |
| Task | {{TYPE_TASK}} |
| Bug | {{TYPE_BUG}} |

## Status IDs

| Status | ID |
|--------|-----|
| New | {{STATUS_NEW}} |
| In progress | {{STATUS_IN_PROGRESS}} |
| In testing | {{STATUS_IN_TESTING}} |
| Closed | {{STATUS_CLOSED}} |
| On hold | {{STATUS_ON_HOLD}} |

## Priority IDs

| Priority | ID |
|----------|-----|
| Low | {{PRIORITY_LOW}} |
| Normal | {{PRIORITY_NORMAL}} |
| High | {{PRIORITY_HIGH}} |
| Immediate | {{PRIORITY_IMMEDIATE}} |

---

## Archon (Knowledge Repository - Documents Only)

| Tool | Description |
|------|-------------|
| `mcp_archon_find_projects()` | List knowledge projects |
| `mcp_archon_find_documents(project_id="{{ARCHON_PROJECT_ID}}")` | List project documents |
| `mcp_archon_manage_document(...)` | Create/update/delete documents |
| `mcp_archon_rag_get_available_sources()` | List knowledge sources |
| `mcp_archon_rag_search_knowledge_base(...)` | Search knowledge base |
| `mcp_archon_rag_search_code_examples(...)` | Find code examples |
| `mcp_archon_rag_read_full_page(...)` | Read full page content |

---

# Important Notes

- Work package status flow: New ({{STATUS_NEW}}) → In progress ({{STATUS_IN_PROGRESS}}) → In testing ({{STATUS_IN_TESTING}}) → Closed ({{STATUS_CLOSED}})
- Keep RAG queries SHORT (2-5 keywords) for better search results
- Higher priority_id = higher priority (Low={{PRIORITY_LOW}}, Normal={{PRIORITY_NORMAL}}, High={{PRIORITY_HIGH}}, Immediate={{PRIORITY_IMMEDIATE}})
- Stories should be {{STORY_MIN_HOURS}} - {{STORY_MAX_HOURS}} hours of work
- **Archon is NOT used for task management - only for knowledge/document management**

---

# BMAD Methodology Integration

## System Architecture

| BMAD Concept | OpenProject Type | Archon Usage |
|--------------|------------------|--------------|
| **Project** | OpenProject Project | Knowledge repository |
| **Epic** | Epic ({{TYPE_EPIC}}) | Store epic specs |
| **Feature** | Feature ({{TYPE_FEATURE}}) | Store feature specs |
| **User Story** | User Story ({{TYPE_USER_STORY}}) | Store acceptance criteria |
| **Task** | Task ({{TYPE_TASK}}) | Implementation details |
| **Documents** | N/A | All technical docs |

## Work Package Creation Patterns

### Creating an Epic
```python
epic = mcp_openproject_create_work_package(
    project_id={{OPENPROJECT_PROJECT_ID}},
    subject="Epic N: Epic Name",
    type_id={{TYPE_EPIC}},
    description="Business goal and scope",
    priority_id={{PRIORITY_HIGH}}
)
```

### Creating a User Story
```python
story = mcp_openproject_create_work_package(
    project_id={{OPENPROJECT_PROJECT_ID}},
    subject="Story N.M: Story Name",
    type_id={{TYPE_USER_STORY}},
    description="""
    As a {persona},
    I want {goal},
    So that {benefit}.
    
    **Acceptance Criteria:**
    Given... When... Then...
    """,
    priority_id={{PRIORITY_NORMAL}}
)
# Set parent to epic
mcp_openproject_set_work_package_parent(
    work_package_id=story["work_package"]["id"],
    parent_id=epic_id
)
```

### Creating a Task
```python
task = mcp_openproject_create_work_package(
    project_id={{OPENPROJECT_PROJECT_ID}},
    subject="Task N.M.P: Task Name",
    type_id={{TYPE_TASK}},
    description="Implementation details"
)
mcp_openproject_set_work_package_parent(
    work_package_id=task["work_package"]["id"],
    parent_id=story_id
)
```

---

# Agent Responsibilities

## PM Agent
- Creates Epics, Features, User Stories from PRD
- Maintains acceptance criteria
- Queries sprint backlog and status

## Dev Agent
- Queries assigned work packages
- Updates task status during implementation
- Logs time against work packages

## SM Agent
- Sprint planning and assignment
- Status reporting
- Blocker management

## Architect Agent
- Creates technical tasks
- Links stories to specifications
- Stores architecture docs in Archon

## TEA Agent
- Creates test tasks
- Updates test status
- Documents test strategies in Archon

---

# Quick Reference

## Start of Day
```python
# Get my open work
mcp_openproject_list_work_packages(
    project_id={{OPENPROJECT_PROJECT_ID}},
    status="open"
)
```

## Starting Work on a Task
```python
# Mark as in progress
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id={{STATUS_IN_PROGRESS}}
)

# Research first
mcp_archon_rag_search_knowledge_base(query="relevant keywords")
```

## Completing Work
```python
# Move to testing
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id={{STATUS_IN_TESTING}}
)

# After review passes
mcp_openproject_update_work_package(
    work_package_id=task_id,
    status_id={{STATUS_CLOSED}}
)
```

---

# Documentation References

For detailed tool documentation:
- OpenProject: `_bmad/integrations/openproject/`
- Archon: `_bmad/integrations/archon/`
- Project Config: `_bmad/_config/project-config.yaml`

